<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Gallery</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; text-align: center; }
        
        /* ログイン画面 */
        #login-screen { margin-top: 50px; }
        input[type="password"] { padding: 10px; font-size: 16px; width: 200px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background-color: #0056b3; }
        #error-msg { color: red; margin-top: 10px; }

        /* 写真一覧画面 */
        #gallery-screen { display: none; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .photo-card { border: 1px solid #ddd; padding: 10px; border-radius: 8px; background: #f9f9f9; }
        .photo-card img { width: 100%; height: auto; border-radius: 4px; object-fit: cover; aspect-ratio: 4/3; }
        .serial-number { font-weight: bold; margin: 5px 0; display: block; }
        .download-btn { display: inline-block; padding: 5px 10px; font-size: 14px; text-decoration: none; background: #28a745; color: white; border-radius: 4px; margin-top: 5px; }
        
        /* ローディング */
        #loading { display: none; margin-top: 20px; color: #666; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h2>パスワードを入力してください</h2>
        <input type="password" id="password-input" placeholder="Password">
        <button onclick="handleLogin()">送信</button>
        <div id="error-msg"></div>
        <div id="loading">確認中...</div>
    </div>

    <div id="gallery-screen">
        <h2>写真一覧</h2>
        <div class="gallery-grid" id="photo-container">
            </div>
    </div>

    <script>
        // 【重要】ここにGASのウェブアプリURLを貼り付けてください
        const GAS_URL = "https://script.google.com/macros/s/AKfycbw0xl3vXAkwR67jI5N8HD3flWVkgCpz4orzYb5b3HX-CJpCKQe8uE2-mHifz5SsIZ4/exec";

        function handleLogin() {
            const password = document.getElementById('password-input').value;
            const errorMsg = document.getElementById('error-msg');
            const loading = document.getElementById('loading');
            
            errorMsg.innerText = "";
            loading.style.display = "block";

            // GASへPOST送信
            fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({ action: "login", password: password })
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = "none";
                if (data.status === 'success') {
                    showGallery(data.data);
                } else if (data.status === 'auth_failed') {
                    errorMsg.innerText = "パスワードが間違っています。";
                } else {
                    errorMsg.innerText = "エラーが発生しました: " + data.message;
                }
            })
            .catch(error => {
                loading.style.display = "none";
                errorMsg.innerText = "通信エラーが発生しました。";
                console.error(error);
            });
        }

        function showGallery(photoList) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('gallery-screen').style.display = 'block';
            
            const container = document.getElementById('photo-container');
            container.innerHTML = ""; // クリア

            photoList.forEach(photo => {
                const card = document.createElement('div');
                card.className = 'photo-card';

                // 画像を表示するためのURL (GASのdoGet経由)
                const imageUrl = `${GAS_URL}?fileId=${photo.fileId}`;
                
                // ダウンロード用リンク（本来のダウンロードURLはDriveの仕様によるが、ここでは画像URLを直接開く形式を採用）
                // ※別タブで開いて保存してもらう形式が最も安定します
                
                card.innerHTML = `
                    <img src="${imageUrl}" loading="lazy" alt="${photo.filename}">
                    <span class="serial-number">No. ${photo.id}</span>
                    <a href="${imageUrl}" target="_blank" class="download-btn" download="${photo.filename}">ダウンロード</a>
                `;
                
                container.appendChild(card);
            });
        }
    </script>
</body>
</html>
